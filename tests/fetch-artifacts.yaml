- name: Test the fetch-artifacts role
  hosts: all
  pre_tasks:
    - name: Create artifacts dir
      file:
        path: "{{ ansible_env.HOME }}/artifacts"
        state: directory
    - name: Create a file in the artifacts directory
      copy:
        dest: "{{ ansible_env.HOME }}/artifacts/test.txt"
        content: foo
  roles:
    - fetch-artifacts
  post_tasks:
    - name: Ensure that the file exists on the executor
      stat:
        path: "{{ zuul.executor.work_root }}/artifacts/test.txt"
      register: test_file
      failed_when: test_file.stat.isfile is defined and test_file.stat.isfile
