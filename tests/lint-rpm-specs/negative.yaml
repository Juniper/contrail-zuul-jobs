- name: test the lint-rpm-specs role for fails
  hosts: all
  pre_tasks:
    - name: 'cleanup rpm spec directory'
      file:
        dest: 'rpms'
        state: 'absent'
    - name: 'create directory for rpm spec'
      file:
        dest: 'rpms'
        state: 'directory'
    - name: 'copy bad rpm spec to working directory'
      copy:
        src: 'fixtures/bad.spec'
        dest: 'rpms/bad.spec'
  tasks:
    - name: 'handle role output'
      block:
        - name: 'include lint-rpm-specs'
          include_role:
            name: 'lint-rpm-specs'
          vars:
            specs_dir: 'rpms'
      rescue:
        - name: 'mark that the role failed'
          set_fact:
            role_failed: True
    - name: 'check if the test failed'
      fail:
        msg: 'Role: passed, expected: failed'
      when: not role_failed

