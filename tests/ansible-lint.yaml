---

- hosts: all
  tasks:
    - name: copy test-requirements.txt
      copy:
        src: '{{ zuul.executor.work_root }}/{{ zuul.project.src_dir }}/test-requirements.txt'
        dest: '{{ ansible_env.HOME }}/'
    - name: 'install test requirements'
      pip:
        requirements: '{{ ansible_env.HOME }}/test-requirements.txt'
      become: true
    - name: copy ansible-lint-rules
      copy:
        src: '{{ zuul.executor.work_root }}/{{ zuul.project.src_dir }}/ansible-lint-rules'
        dest: '{{ ansible_env.HOME }}/'

  roles:
    - install-pip-virtualenv
    # Roles are exeuted before tasks
    # pip is needed to install test requirements

- include: ansible-lint/positive.yaml
- include: ansible-lint/negative.yaml

