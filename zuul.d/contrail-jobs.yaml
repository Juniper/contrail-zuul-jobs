# Jobs for testing Contrail projects

- job:
    name: contrail-vnc-base2
    parent: contrail-base2
    description: |
      A base job that prepares Contrail VNC sandbox using Android repo,
      as opposed to the contrail-src-base job that copies the sources directly.
    required-projects:
      - Juniper/contrail-analytics
      - Juniper/contrail-api-client
      - Juniper/contrail-build
      - Juniper/contrail-common
      - Juniper/contrail-controller
      - name: Juniper/contrail-dpdk
        override-checkout: contrail_dpdk_17_02
      - Juniper/contrail-fabric-utils
      - Juniper/contrail-generateDS
      - Juniper/contrail-java-api
      - Juniper/contrail-heat
      - Juniper/contrail-neutron-plugin
      - Juniper/contrail-nova-extensions
      - Juniper/contrail-nova-vif-driver
      - Juniper/contrail-packages
      - Juniper/contrail-packaging
      - Juniper/contrail-provisioning
      - Juniper/contrail-sandesh
      - Juniper/contrail-specs
      - Juniper/contrail-test
      - Juniper/contrail-test-ci
      - Juniper/contrail-third-party
      - Juniper/contrail-vcenter-plugin
      - Juniper/contrail-vnc
      - Juniper/contrail-vrouter
      - Juniper/contrail-vrouter-java-api
      - Juniper/contrail-vro-plugin
      - Juniper/contrail-web-controller
      - Juniper/contrail-web-core
      - Juniper/contrail-web-server-manager
      - Juniper/contrail-web-storage
      - Juniper/contrail-webui-third-party
      - Juniper/vijava
    irrelevant-files:
      - specs/.*
    pre-run: playbooks/contrail-vnc-base2/pre

- job:
    name: contrail-vnc-build-package-centos74
    parent: contrail-vnc-build-package-el-base
    irrelevant-files:
      - specs/.*
    nodeset:
      nodes:
        - name: builder
          label: centos-7-4-builder

- job:
    name: contrail-vnc-build-package-rhel7
    parent: contrail-vnc-build-package-el-base
    irrelevant-files:
      - specs/.*
    nodeset: builder-rhel-7

- job:
    name: contrail-vnc-unittest-base
    parent: contrail-vnc-base2
    irrelevant-files:
      - specs/.*
    run: playbooks/contrail-vnc-unittest/main
    post-run: playbooks/contrail-vnc-unittest/post

- job:
    name: contrail-vnc-unittest-ubuntu-trusty
    parent: contrail-vnc-unittest-base
    nodeset: builder-ubuntu-trusty

- job:
    name: contrail-vnc-unittest-centos7
    parent: contrail-vnc-unittest-base
    voting: False
    nodeset: builder-centos-7

- job:
    name: contrail-sanity-centos7-kolla-base
    parent: contrail-systest-base
    required-projects:
      - Juniper/contrail-ansible-deployer
      - name: Juniper/contrail-kolla-ansible
        override-checkout: contrail/ocata
      - Juniper/contrail-test
      - Juniper/contrail-test-ci
    nodeset:
      nodes:
        - name: kolla-aio
          label: c7-systest-c

- job:
    name: contrail-sanity-centos7-kolla-ocata
    parent: contrail-sanity-centos7-kolla-base
    run: playbooks/contrail-sanity-centos7-kolla-ocata/run
    vars:
      cloud_orchestrator: openstack
      openstack_version: ocata
      kolla_docker_distro: centos
      kolla_version: ocata

- job:
    name: contrail-sanity-centos7-kolla-ocata-dev
    parent: contrail-sanity-centos7-kolla-base
    run: playbooks/contrail-sanity-centos7-kolla-ocata-dev/run

- job:
    name: contrail-sanity-centos7-k8s
    parent: contrail-systest-base
    description: |
      A job that deploys Contrail containers and a Kubernetes cluster
      using contrail-ansible-deployer.
    run: playbooks/contrail-sanity-centos7-k8s/run
    vars:
      cloud_orchestrator: kubernetes
      test_target: k8s_sanity
    required-projects:
      - Juniper/contrail-ansible-deployer
      - Juniper/contrail-test
      - Juniper/contrail-test-ci
    nodeset:
      nodes:
        - name: kolla-aio
          label: c7-systest-c

- job:
    name: contrail-helm-base
    parent: contrail-systest-base
    description: |
      A job that deploys Contrail and OpenStack containers using contrail-helm-deployer
    post-run: playbooks/contrail-sanity-ubuntu1604-helm-ocata/post
    required-projects:
      - Juniper/openstack-helm
      - Juniper/contrail-helm-deployer
      - Juniper/openstack-helm-infra
      - Juniper/contrail-test
      - Juniper/contrail-test-ci
    nodeset:
      nodes:
        - name: helm-aio
          label: ubuntu-xenial-builder-xxlarge
    roles:
      - zuul: Juniper/contrail-helm-deployer

- job:
    name: contrail-sanity-ubuntu1604-helm-ocata
    parent: contrail-helm-base
    run: playbooks/contrail-sanity-ubuntu1604-helm-ocata/run
    vars:
      openstack_version: ocata
      test_target: k8s_sanity

- job:
    name: contrail-deploy-ubuntu1604-helm-ocata
    parent: contrail-helm-base
    run: playbooks/contrail-deploy-ubuntu1604-helm-ocata/run
    vars:
      openstack_version: ocata

- job:
    name: contrail-vnc-build-package-el-makefile
    parent: contrail-vnc-base
    description: |
      Job that tests Contrail VNC using new Makefile from contrail-packages.
    run: playbooks/packaging/contrail-vnc-el-makefile
    vars:
      # This is required for Makefile: 'TRUE"/'FALSE' instead of a boolean
      build_debuginfo: 'FALSE'
    irrelevant-files:
      - specs/.*
    nodeset:
      nodes:
        - name: builder
          label: centos-7-4-builder

- job:
    name: contrail-vnc-build-containers-base
    parent: contrail-base2
    pre-run: playbooks/contrail-vnc-build-containers/pre
    run: playbooks/contrail-vnc-build-containers/run
    required-projects:
      - Juniper/contrail-container-builder
    vars:
      setup_docker_registry: True

- job:
    name: contrail-vnc-build-containers-centos7-newton
    parent: contrail-vnc-build-containers-base
    nodeset: builder-centos-7
    vars:
      openstack_version: newton

- job:
    name: contrail-vnc-build-containers-centos7-ocata
    parent: contrail-vnc-build-containers-base
    nodeset: builder-centos-7
    vars:
      openstack_version: ocata

- job:
    name: contrail-vnc-build-containers-rhel7-newton
    parent: contrail-vnc-build-containers-base
    nodeset: builder-rhel-7
    vars:
      openstack_version: newton

- job:
    name: contrail-vnc-build-containers-rhel7-ocata
    parent: contrail-vnc-build-containers-base
    nodeset: builder-rhel-7
    vars:
      openstack_version: ocata

- job:
    name: post-nightly-registry-port
    voting: False
    parent: contrail-base2
    run: playbooks/post-nightly-registry-port
    nodeset: ubuntu-xenial
    vars:
      release_type: nightly
      setup_docker_registry: true

- job:
    name: contrail-vnc-base-mk
    parent: contrail-base
    description: |
      A base job that prepares Contrail VNC sandbox using Android repo,
      as opposed to the contrail-src-base job that copies the sources directly.
    irrelevant-files:
      - specs/.*
    run: playbooks/contrail/prepare
