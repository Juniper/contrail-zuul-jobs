---
- name: Define path variables
  set_fact:
    src_path: "{{ ansible_env.HOME }}/docs"
    dst_path: "{{ zuul.executor.work_root }}/docs"

- name: Check if the docs source dir is created on worker
  stat:
    path: "{{ src_path }}"
  register: docs_dir
  become: true

- name: Perform the fetch to executor
  when: docs_dir.stat.isdir is defined and docs_dir.stat.isdir
  block:
    - name: Create the target directory on executor
      file:
        path: "{{ dst_path }}"
        state: directory
      delegate_to: localhost
    - name: Fetch docs
      synchronize:
        src: "{{ src_path }}"
        dest: "{{ dst_path }}"
        mode: pull
        recursive: yes
      become: true
