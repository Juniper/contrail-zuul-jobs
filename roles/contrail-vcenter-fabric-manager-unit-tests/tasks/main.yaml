---
- name: install basic packages
  yum:
    name:
      - flex
      - bison
      - epel-release
      - createrepo
      - gcc
      - gcc-c++
      - gdb
      - git
      - kernel
      - make
      - python-devel
      - python-pip
      - python36
      - python3-pip
      - rpm-build
      - wget
      - yum-utils
    state: present
  become: true

- name: upgrade pip packages
  pip:
    name:
      - "pip"
      - "tox"
  become: true

- name: run unit tests
  command: "scons vcenter-fabric-manager:test"
  args:
    chdir: '{{ packaging.target_dir }}'
  register: result
  failed_when: result.rc  != 0
