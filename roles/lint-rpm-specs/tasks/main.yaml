# This role lints all spec files found in the repository.
---

- name: Install rpmlint
  package:
    name: rpmlint
    state: installed
  become: True

- name: Lint spec files
  command: 'rpmlint {{ zuul.project.src_dir }}'
  register: 'linter_out'
  ignore_errors: True

- name: Print summary of errors
  command: 'rpmlint -I {{ linter_out.stdout_lines | map("regex_search", "[EW]: ([%a-z-]+)") | map("regex_replace","[EW]: ", "") | unique | join(" -I ") }}'
  when: 'linter_out.rc != 0'

- fail:
    msg: "There were errors found usinf rpmlint!"
  when: 'linter_out.rc != 0'
