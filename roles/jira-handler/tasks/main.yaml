---
- name: Set zuul-log-path fact
  include_role:
    name: set-zuul-log-path-fact

- name: copy requirements.txt to temp folder
  copy:
    src: "requirements.txt"
    dest: "/tmp/requirements.txt"

- name: install pip dependencies
  pip:
    requirements: "/tmp/requirements.txt"
    executable: pip3
  become: true

- name: Create jira issue
  jira_handler:
    username: "{{ jira.username }}"
    password: "{{ jira.token }}"
    build_number: "{{ build_number }}"
    branch: "{{ branch }}"
    details: "{{ zuul_log_path }}"
  register: jira_std
  when: not zuul_success | bool
  no_log: true

- debug:
    msg: "{{ jira_std }}"