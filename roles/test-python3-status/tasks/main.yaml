---

- name: copy and change permission of files
  copy:
    src: "{{ item }}"
    dest: "."
    mode: '0755'
  with_items:
    - python3-status-check.sh
    - requirements.txt

- name: install repo 
  shell: |
     curl -s https://storage.googleapis.com/git-repo-downloads/repo > /usr/bin/repo 
     chmod a+x /usr/bin/repo
  become: true

- name: repo sync controller 
  shell: |
    repo init --no-clone-bundle -q -u https://github.com/Juniper/contrail-vnc -b master
    repo sync --no-clone-bundle -q contrail-controller
  become: true

- name: run python3 status check script
  shell: |
    mkdir artifacts
    bash python3-status-check.sh --report artifacts/python3-status-report.xml
  become: true

- name: Copy the XML report to logdir
  roles:
    - fetch-artifacts