---
- name: Check if the docs source dir is created on executor
  delegate_to: localhost
  stat:
    path: "{{ zuul.executor.work_root }}/{{ root_files }}"
  register: docs_dir
  failed_when: dest_dir.stat.exists is not defined
  become: true

- name: Ensure docs are readable before uploading
  delegate_to: localhost
  become: true
  when: docs_dir.stat.isdir is defined and docs_dir.stat.isdir
  file:
    path: "{{ zuul.executor.work_root }}/{{ root_files }}"
    mode: u=rwX,g=rX,o=rX
    state: directory
    recurse: yes

- name: Upload doc to docs server
  when: docs_dir.stat.isdir is defined and docs_dir.stat.isdir
  synchronize:
    src: "{{ zuul.executor.work_root }}/{{ root_files }}"
    dest: "{{ zuul.executor.work_root }}/{{ zuul_docserver_root }}"
  no_log: false
