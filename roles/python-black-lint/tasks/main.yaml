---
- name: prepare virtual env
  command: virtualenv "{{ zuul_project_dir }}/venv"
    creates="{{ zuul_project_dir }}/venv/bin/activate"

- name: install black inside virtenv
  pip:
    name: black
    virtualenv_site_packages: yes
    virtualenv: /{{ zuul_project_dir }}/venv

- name: run black linter on project
  command: "black {{ zuul_project_dir }}/cvfm {{ zuul_project_dir }}/tests --check"
  register: linter_result
  failed_when: linter_result.rc == 1
