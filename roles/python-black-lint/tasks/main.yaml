---
- name: prepare virtual env
  shell: virtualenv "{{ zuul_project_dir }}/venv"
    creates="{{ zuul_project_dir }}/venv/bin/activate"

- name: install dependencies
  pip:
    requirements: "{{ zuul_project_dir }}/requirements.txt"
    virtualenv: "{{ zuul_project_dir }}/venv"

- name: install black inside virtenv
  pip:
    name: "black"
    virtualenv: "{{ zuul_project_dir }}/venv"

- name: run black linter on project
  shell: "black {{ zuul_project_dir }}/cvfm {{ zuul_project_dir }}/tests --check"
  register: linter_result
  failed_when: linter_result.rc == 1
