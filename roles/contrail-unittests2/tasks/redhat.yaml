---
- name: enable EPEL repository (RedHat)
  ini_file:
    dest: /etc/yum.repos.d/epel.repo
    section: epel
    option: enabled
    value: 1
  become: true

# XXX(kklimonda): seems like EPEL repomd.xml is not deleted by configure-mirrors
#   and our EPEL mirror is too old to override cache. Nuke the cache from orbit.
- name: clean-up yum cache
  command: "yum clean all"
  become: true

# XXX(kklimonda): workaround for yum-builddep force-enabling non-existing repo
- name: remove epel-source repository completely (RedHat)
  ini_file:
    dest: /etc/yum.repos.d/epel.repo
    section: epel-source
    option: enabled
    value: 0
  become: true

- name: Install system build dependencies
  command: make dep
  args:
    chdir: "{{ packaging.target_dir }}/tools/packages"
  become: true

- name: Fetch third-party dependencies
  command: "python fetch_packages.py --site-mirror http://{{ zuul_site_mirror_fqdn }}"
  args:
    chdir: "{{ packaging.target_dir }}/third_party/"

