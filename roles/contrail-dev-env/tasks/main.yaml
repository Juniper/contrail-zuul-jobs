- name: install docker py
  package:
    name: python-docker
    state: present
  become: true

- name: install git
  package:
    name: git
    state: present
  become: true

- name: checkout dev-env
  git:
    dest: ./contrail-dev-env
    repo: https://github.com/Juniper/contrail-dev-env
    version: master

- name: startup
  command: ./startup.sh
  args:
    chdir: "{{ ansible_env.HOME }}/contrail-dev-env"
  become: true

- name: Test contrail-dev-env
  include: docker_exec.yaml
  with_items:
    - chdir: /root/contrail
      command: repo sync -j $(nproc)
    - chdir: /root/contrail-dev-env
      command: make setup
    - chdir: /root/contrail-dev-env
      command: make dep
    - chdir: /root/contrail-dev-env
      command: make list
    - chdir: /root/contrail-dev-env
      command: make rpm
    - chdir: /root/contrail-dev-env
      command: make containers
