---
- name: Install deploy-for-k8s script dependencies
  package:
    name: '{{ item }}'
    state: present
  become: true
  with_items:
    - unzip
    - wget

- name: Download Go toolchain to /tmp/
  get_url:
    url: https://dl.google.com/go/go1.10.3.linux-amd64.tar.gz
    dest: /tmp/go.tar.gz

- name: Extract Go toolchain to /usr/
  unarchive:
    src: /tmp/go.tar.gz
    dest: /usr/
    remote_src: yes
  become: yes
  become_user: root

- name: Create directory for Contrail repository
  file:
    path: '{{ sourcedir }}/go/src/github.com/Juniper/contrail'
    state: directory

- name: Copy Contrail repository to GOPATH/src/github.com/Juniper/
  command: 'cp -r {{ sourcedir }}/src/review.opencontrail.org/Juniper/contrail {{ sourcedir }}/go/src/github.com/Juniper/'

- name: Run deploy-for-k8s script
  command: '{{ sourcedir }}/go/src/github.com/Juniper/contrail/tools/deploy-for_k8s.sh'
  environment:
    PATH: '{{ ansible_env.PATH }}:/usr/go/bin'
