- name: set control IP
  set_fact:
    control_ip: "{{ hostvars['control-plane'].ansible_default_ipv4.address if multinode else ansible_default_ipv4.address }}"

- name: set compute IP
  set_fact:
    compute_ip: "{{ hostvars['data-plane'].ansible_default_ipv4.address if multinode else ansible_default_ipv4.address }}"

- name: Copy template for testrunner
  template:
    src: "instances{% if multinode %}-multinode{% endif %}.yaml.j2"
    dest: "{{ ansible_env.HOME }}/contrail_test_input.yaml"

- name: Copy config to contrail-ansible-deployer config dir
  copy:
    src: "{{ ansible_env.HOME }}/contrail_test_input.yaml"
    dest: "{{ docker_provision_dir }}/config/instances.yaml"
    remote_src: yes

- name: Fetch instances.yaml to executor
  synchronize:
    src: "{{ docker_provision_dir }}/config/instances.yaml"
    dest: "{{ zuul.executor.log_root }}/"
    mode: pull
