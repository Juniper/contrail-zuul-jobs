---

- name: template ose-install inventory file
  template:
    src: 'ose-install.j2'
    dest: '{{ zuul_project_dir }}/inventory/byo/ose-install'
    force: true

- name: install ansible
  become: true
  pip:
    name: 'ansible'
    version: '2.5.2'
    state: 'present'

- name: install python-netaddr
  become: true
  pip:
    name: 'netaddr'
    state: 'present'

- name: install NetworkManager
  become: true
  package:
    name: 'NetworkManager'
    state: 'present'

- name: start and enable NetworkManager
  become: true
  service:
    name: 'NetworkManager'
    state: 'started'
    enabled: true

- name: run inventory/byo/ose-prerequisites.yml playbook
  args:
    chdir: '{{ zuul_project_dir }}'
  become: true
  command: 'ansible-playbook -i inventory/byo/ose-install inventory/byo/ose-prerequisites.yml'

- name: run playbooks/byo/openshift-facts.yml playbook
  args:
    chdir: '{{ zuul_project_dir }}'
  become: true
  command: 'ansible-playbook -i inventory/byo/ose-install playbooks/byo/openshift_facts.yml'

- name: run playbooks/byo/config.yml playbook
  args:
    chdir: '{{ zuul_project_dir }}'
  become: true
  command: 'ansible-playbook -i inventory/byo/ose-install playbooks/byo/config.yml'
