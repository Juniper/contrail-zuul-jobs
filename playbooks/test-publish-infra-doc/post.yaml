---
- hosts: all
  roles:
    - role: fetch-docs
      fetch_src_path: '{{ zuul.projects | selectattr("short_name", "equalto", "contrail-infra-doc") | map(attribute="src_dir") | list | first }}/build/html'
      fetch_dst_path: "{{ zuul.executor.work_root }}/build/html"

- hosts: builder
  gather_facts: False
  pre_tasks:
    - name: Create src_dir
      file:
        path: "var/www/static/infra-doc/"
        state: directory

  roles:
    - role: upload-docs
      zuul_docserver_root: "var/www/static/infra-doc/"
      docs_dir: "{{ zuul.executor.work_root }}/build/html"

  post_tasks:
    - name: Clean up data
      file:
        state: absent
        path: "var/www"
